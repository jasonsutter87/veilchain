{{ define "main" }}
<section class="auth-page">
  <div class="auth-container">
    <div class="auth-card">
      <div class="auth-card__header">
        <div class="auth-card__logo">
          <svg viewBox="0 0 40 40" width="48" height="48">
            <circle cx="20" cy="20" r="18" fill="none" stroke="#38bdf8" stroke-width="2"/>
            <circle cx="20" cy="12" r="4" fill="#22c55e"/>
            <circle cx="12" cy="24" r="3" fill="#38bdf8"/>
            <circle cx="28" cy="24" r="3" fill="#38bdf8"/>
            <line x1="20" y1="16" x2="12" y2="21" stroke="#475569" stroke-width="1.5"/>
            <line x1="20" y1="16" x2="28" y2="21" stroke="#475569" stroke-width="1.5"/>
          </svg>
        </div>
        <h1 class="auth-card__title">Create your account</h1>
        <p class="auth-card__subtitle">Start building with VeilChain in minutes</p>
      </div>

      <form id="register-form" class="auth-form">
        <div class="auth-form__group">
          <label for="name" class="auth-form__label">Full Name</label>
          <input type="text" id="name" name="name" class="auth-form__input" placeholder="John Doe" required>
        </div>

        <div class="auth-form__group">
          <label for="email" class="auth-form__label">Email</label>
          <input type="email" id="email" name="email" class="auth-form__input" placeholder="you@example.com" required>
        </div>

        <div class="auth-form__group">
          <label for="password" class="auth-form__label">Password</label>
          <input type="password" id="password" name="password" class="auth-form__input" placeholder="Create a strong password" required minlength="8">
          <span class="auth-form__hint">Must be at least 8 characters</span>
        </div>

        <div class="auth-form__group">
          <label for="confirm-password" class="auth-form__label">Confirm Password</label>
          <input type="password" id="confirm-password" name="confirm-password" class="auth-form__input" placeholder="Confirm your password" required>
        </div>

        <div class="auth-form__options">
          <label class="auth-form__checkbox">
            <input type="checkbox" name="terms" required>
            <span>I agree to the <a href="/terms-of-use/">Terms of Service</a> and <a href="/privacy-policy/">Privacy Policy</a></span>
          </label>
        </div>

        <button type="submit" class="auth-form__submit">
          <span>Create Account</span>
          <i class="fas fa-arrow-right"></i>
        </button>

        <div id="register-error" class="auth-form__error" style="display: none;">
          <i class="fas fa-exclamation-circle"></i>
          <span></span>
        </div>

        <div id="register-success" class="auth-form__success" style="display: none;">
          <i class="fas fa-check-circle"></i>
          <span></span>
        </div>
      </form>

      <div class="auth-card__divider">
        <span>Or sign up with</span>
      </div>

      <div class="auth-card__social">
        <button type="button" class="auth-social-btn" id="github-signup">
          <i class="fab fa-github"></i>
          <span>GitHub</span>
        </button>
        <button type="button" class="auth-social-btn" id="google-signup">
          <i class="fab fa-google"></i>
          <span>Google</span>
        </button>
      </div>

      <div class="auth-card__footer">
        <p>Already have an account? <a href="/login/">Sign in</a></p>
      </div>
    </div>

    <div class="auth-footer">
      <a href="/">Home</a>
      <a href="/docs/">Documentation</a>
      <a href="/privacy-policy/">Privacy</a>
    </div>
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('register-form');
  const errorDiv = document.getElementById('register-error');
  const successDiv = document.getElementById('register-success');

  form.addEventListener('submit', async function(e) {
    e.preventDefault();

    const name = document.getElementById('name').value;
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    const confirmPassword = document.getElementById('confirm-password').value;

    // Reset messages
    errorDiv.style.display = 'none';
    successDiv.style.display = 'none';

    // Validate passwords match
    if (password !== confirmPassword) {
      errorDiv.querySelector('span').textContent = 'Passwords do not match';
      errorDiv.style.display = 'flex';
      return;
    }

    try {
      const response = await fetch('/api/v1/auth/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, email, password })
      });

      const data = await response.json();

      if (response.ok) {
        successDiv.querySelector('span').textContent = 'Account created! Redirecting to login...';
        successDiv.style.display = 'flex';

        setTimeout(() => {
          window.location.href = '/login/';
        }, 2000);
      } else {
        errorDiv.querySelector('span').textContent = data.error?.message || 'Registration failed';
        errorDiv.style.display = 'flex';
      }
    } catch (err) {
      errorDiv.querySelector('span').textContent = 'Network error. Please try again.';
      errorDiv.style.display = 'flex';
    }
  });

  document.getElementById('github-signup').addEventListener('click', function() {
    window.location.href = '/api/v1/auth/github';
  });

  document.getElementById('google-signup').addEventListener('click', function() {
    window.location.href = '/api/v1/auth/google';
  });
});
</script>
{{ end }}
