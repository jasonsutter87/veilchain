{{ define "main" }}
<section class="auth-page">
  <div class="auth-container">
    <div class="auth-card">
      <div class="auth-card__header">
        <div class="auth-card__logo">
          <svg viewBox="0 0 40 40" width="48" height="48">
            <circle cx="20" cy="20" r="18" fill="none" stroke="#38bdf8" stroke-width="2"/>
            <circle cx="20" cy="12" r="4" fill="#22c55e"/>
            <circle cx="12" cy="24" r="3" fill="#38bdf8"/>
            <circle cx="28" cy="24" r="3" fill="#38bdf8"/>
            <line x1="20" y1="16" x2="12" y2="21" stroke="#475569" stroke-width="1.5"/>
            <line x1="20" y1="16" x2="28" y2="21" stroke="#475569" stroke-width="1.5"/>
          </svg>
        </div>
        <h1 class="auth-card__title">Sign in to VeilChain</h1>
        <p class="auth-card__subtitle">Access your dashboard and manage your ledgers</p>
      </div>

      <form id="login-form" class="auth-form">
        <div class="auth-form__group">
          <label for="email" class="auth-form__label">Email</label>
          <input type="email" id="email" name="email" class="auth-form__input" placeholder="you@example.com" required>
        </div>

        <div class="auth-form__group">
          <label for="password" class="auth-form__label">Password</label>
          <input type="password" id="password" name="password" class="auth-form__input" placeholder="Enter your password" required>
        </div>

        <div class="auth-form__options">
          <label class="auth-form__checkbox">
            <input type="checkbox" name="remember">
            <span>Remember me</span>
          </label>
          <a href="/forgot-password/" class="auth-form__link">Forgot password?</a>
        </div>

        <button type="submit" class="auth-form__submit">
          <span>Sign In</span>
          <i class="fas fa-arrow-right"></i>
        </button>

        <div id="login-error" class="auth-form__error" style="display: none;">
          <i class="fas fa-exclamation-circle"></i>
          <span></span>
        </div>
      </form>

      <div class="auth-card__divider">
        <span>Or continue with</span>
      </div>

      <div class="auth-card__social">
        <button type="button" class="auth-social-btn" id="github-login">
          <i class="fab fa-github"></i>
          <span>GitHub</span>
        </button>
        <button type="button" class="auth-social-btn" id="google-login">
          <i class="fab fa-google"></i>
          <span>Google</span>
        </button>
      </div>

      <div class="auth-card__footer">
        <p>Don't have an account? <a href="/register/">Sign up</a></p>
      </div>
    </div>

    <div class="auth-footer">
      <a href="/">Home</a>
      <a href="/docs/">Documentation</a>
      <a href="/privacy-policy/">Privacy</a>
    </div>
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('login-form');
  const errorDiv = document.getElementById('login-error');

  form.addEventListener('submit', async function(e) {
    e.preventDefault();

    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    const remember = form.querySelector('input[name="remember"]').checked;

    try {
      const response = await fetch('/api/v1/auth/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password, remember })
      });

      const data = await response.json();

      if (response.ok) {
        localStorage.setItem('veilchain_token', data.token);
        localStorage.setItem('veilchain_user', JSON.stringify(data.user));
        window.location.href = '/dashboard/';
      } else {
        errorDiv.querySelector('span').textContent = data.error?.message || 'Invalid credentials';
        errorDiv.style.display = 'flex';
      }
    } catch (err) {
      errorDiv.querySelector('span').textContent = 'Network error. Please try again.';
      errorDiv.style.display = 'flex';
    }
  });

  document.getElementById('github-login').addEventListener('click', function() {
    window.location.href = '/api/v1/auth/github';
  });

  document.getElementById('google-login').addEventListener('click', function() {
    window.location.href = '/api/v1/auth/google';
  });
});
</script>
{{ end }}
