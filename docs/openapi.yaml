openapi: 3.0.3
info:
  title: VeilChain API
  description: |
    Bitcoin-grade immutability without the blockchain baggage.

    VeilChain provides an append-only ledger with Merkle tree integrity,
    cryptographic chaining, and external anchoring capabilities.

    ## Authentication

    Most endpoints require authentication via API key or JWT token.
    Include the API key in the `X-API-Key` header or JWT in the `Authorization` header.

    ## WebSocket API

    Real-time updates are available via WebSocket connections:
    - `ws://host/v1/ws` - Subscribe to all ledger events
    - `ws://host/v1/ledgers/:id/ws` - Subscribe to specific ledger events

  version: 1.0.0
  contact:
    name: VeilChain Support
    email: support@veilchain.io
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:3000
    description: Local development
  - url: https://api.veilchain.io
    description: Production

security:
  - apiKeyAuth: []
  - bearerAuth: []

tags:
  - name: Health
    description: Health check endpoints
  - name: Ledgers
    description: Ledger management
  - name: Entries
    description: Entry operations
  - name: Proofs
    description: Merkle proof operations
  - name: Anchors
    description: External anchoring
  - name: Public
    description: Public verification endpoints (no auth required)

paths:
  /health:
    get:
      tags:
        - Health
      summary: Health check
      security: []
      responses:
        '200':
          description: Healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [ok, degraded, error]
                  version:
                    type: string
                  uptime:
                    type: number

  /v1/ledgers:
    get:
      tags:
        - Ledgers
      summary: List all ledgers
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 100
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
        - name: includeArchived
          in: query
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: List of ledgers
    post:
      tags:
        - Ledgers
      summary: Create a new ledger
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                description:
                  type: string
                schema:
                  type: object
      responses:
        '201':
          description: Ledger created

  /v1/ledgers/{id}:
    get:
      tags:
        - Ledgers
      summary: Get ledger metadata
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Ledger metadata
        '404':
          description: Not found
    delete:
      tags:
        - Ledgers
      summary: Archive (soft delete) a ledger
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Ledger archived

  /v1/ledgers/{id}/unarchive:
    post:
      tags:
        - Ledgers
      summary: Restore an archived ledger
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Ledger restored

  /v1/ledgers/{id}/root:
    get:
      tags:
        - Ledgers
      summary: Get current root hash
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Current root hash

  /v1/ledgers/{id}/entries:
    get:
      tags:
        - Entries
      summary: List entries
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - name: limit
          in: query
          schema:
            type: integer
        - name: offset
          in: query
          schema:
            type: string
      responses:
        '200':
          description: List of entries
    post:
      tags:
        - Entries
      summary: Append an entry
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  type: object
                idempotencyKey:
                  type: string
                metadata:
                  type: object
      responses:
        '201':
          description: Entry appended

  /v1/ledgers/{id}/entries/{entryId}:
    get:
      tags:
        - Entries
      summary: Get an entry
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - name: entryId
          in: path
          required: true
          schema:
            type: string
        - name: includeProof
          in: query
          schema:
            type: boolean
            default: true
      responses:
        '200':
          description: Entry details

  /v1/ledgers/{id}/proof/{entryId}:
    get:
      tags:
        - Proofs
      summary: Get inclusion proof
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - name: entryId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Merkle proof

  /v1/verify:
    post:
      tags:
        - Proofs
      summary: Verify a proof
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - proof
              properties:
                proof:
                  type: object
                  properties:
                    leaf:
                      type: string
                    index:
                      type: integer
                    proof:
                      type: array
                      items:
                        type: string
                    directions:
                      type: array
                      items:
                        type: string
                    root:
                      type: string
      responses:
        '200':
          description: Verification result

  /v1/ledgers/{id}/anchors:
    get:
      tags:
        - Anchors
      summary: List anchors
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, confirmed, failed]
        - name: type
          in: query
          schema:
            type: string
            enum: [bitcoin, ethereum, opentimestamps, rfc3161]
      responses:
        '200':
          description: List of anchors

  /v1/ledgers/{id}/anchor:
    post:
      tags:
        - Anchors
      summary: Create an anchor
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - type
              properties:
                type:
                  type: string
                  enum: [bitcoin, ethereum, opentimestamps, rfc3161]
      responses:
        '201':
          description: Anchor created

  /v1/ledgers/{id}/anchors/{anchorId}:
    get:
      tags:
        - Anchors
      summary: Get an anchor
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - name: anchorId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Anchor details

  /v1/public/ledgers/{id}/root:
    get:
      tags:
        - Public
      summary: Get public root hash
      security: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Public root hash

  /v1/public/ledgers/{id}/roots:
    get:
      tags:
        - Public
      summary: Get historical roots
      security: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Historical roots

  /v1/public/verify:
    post:
      tags:
        - Public
      summary: Verify a proof (public)
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Verification result

components:
  securitySchemes:
    apiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
